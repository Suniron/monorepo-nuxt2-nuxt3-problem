CREATE OR REPLACE FUNCTION public.update_vulnerability_asset_status()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin

  UPDATE
	public.vulnerability_asset vast
SET
	status = 'remediated'
FROM
	public.remediation_project_scope rps
WHERE
	rps.fk_project_id = new.fk_project_id
	AND rps.fk_vulnerability_asset_id = vast.id
	AND rps.is_done IS TRUE
  ;
  
  return new;
end;

$function$
;