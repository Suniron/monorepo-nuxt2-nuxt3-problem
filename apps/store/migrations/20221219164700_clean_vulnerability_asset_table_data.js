// @ts-check

/**
 *
 * @param {import("knex").Knex} knex
 * @returns
 */
exports.up = async (knex) => {
  // If already setup, ignore
  if (knex.userParams.isSetup)
    return Promise.resolve()

  // Replace all "" by NULL for severity, confidence, likelihood, details, exploit_code_maturity, exploitability_ease, patch_publication_date, plugin_modification_date, vuln_publication_date
  await knex.raw(`
    UPDATE vulnerability_asset
    SET severity = NULL
    WHERE severity = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET confidence = NULL
    WHERE confidence = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET likelihood = NULL
    WHERE likelihood = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET details = NULL
    WHERE details = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET exploit_code_maturity = NULL
    WHERE exploit_code_maturity = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET exploitability_ease = NULL
    WHERE exploitability_ease = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET patch_publication_date = NULL
    WHERE patch_publication_date = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET plugin_modification_date = NULL
    WHERE plugin_modification_date = '' ;
  `)
  await knex.raw(`
    UPDATE vulnerability_asset
    SET vuln_publication_date = NULL
    WHERE vuln_publication_date = '' ;
  `)
}

/**
 *
 * @param {import("knex").Knex} _knex
 * @returns
 */
exports.down = (_knex) => {
  // No rollback
  return Promise.resolve()
}
