<template>
  <v-card>
    <v-card-title>
      Remove vulnerability
    </v-card-title>
    <v-card-text>
      <v-container>
        <v-row>
          <v-card-text>
            Do you confirm to remove the vulnerability?
            <br /><strong>This action cannot be undone!</strong><br /><br />
          </v-card-text>
        </v-row>
        <v-row>
          <v-col class="actions">
            <v-btn
              class="mr-2"
              :disabled="isLoading"
              @click.stop="$root.$emit('ModalForDelete', false)"
            >
              No, cancel
            </v-btn>
            <v-btn
              color="primary"
              :loading="isLoading"
              @click.stop="saveVuln()"
            >
              Yes, remove
            </v-btn>
          </v-col>
        </v-row>
      </v-container>
    </v-card-text>
  </v-card>
</template>
<script>
import { searchVulnerabilitiesWithTheirAssetsService } from '~/services/vulnerabilities'
import { deleteAssetVulnerabilities } from '~/services/assets'
export default {
  props: {
    assetId: {
      type: Number,
      required: true
    },
    item: {
      type: Object,
      required: true
    }
  },
  data() {
    return {
      isFormValid: false,
      isLoading: false
    }
  },
  created() {
    this.form = this.item
    this.fetchVulnerabilities()
  },
  methods: {
    async fetchVulnerabilities() {
      const data = await searchVulnerabilitiesWithTheirAssetsService(
        this.$axios,
        {}
      )
      this.vulns = data.vulnerabilities
    },
    async saveVuln() {
      await deleteAssetVulnerabilities(this.$axios, this.item)
      this.$root.$emit('ModalForDelete', false)
      this.$root.$emit('handleChangeOnVulnForm', this.form, this.itemvulN)
    },
    changeItem(form) {
      console.log(form)
      const idx = this.form.ips.findIndex((e) => e.id === form.id)
      this.form.ips[idx] = {
        id: form.id,
        ip_id: form.ipId.ip_id,
        address: form.ipId.address,
        ports: form.ports
      }
    }
  }
}
</script>
